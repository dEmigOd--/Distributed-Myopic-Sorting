\documentclass[tikz]{standalone}

\usepackage{amsmath, amssymb}
\usepackage{fmtcount}% http://ctan.org/pkg/fmtcount
\usetikzlibrary{calc, patterns}
\usepackage{import}
\usepackage{standalone}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% note, 
%	0 - is an empty space; left uncolored
%	1 - is an other agent; filled with black
%	2 - is an edge; cross-hatched
%	3 - is a do not care location
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

	%% print a single node values at specific location
	\newcommand{\SetNodeValue}[4]{%
		\begin{scope}[shift={(#1, #2)}]
			\foreach \pickedDirection[count=\i] in {\uparrow, \rightarrow, \downarrow, \leftarrow, \varnothing}{%
				\ifnum#4=\i
					\node[above] at (0, 0) {$\padzeroes[\memwidth]{\binarynum{#3}}$};
					\node[below] at (0, {\adjustdirectionlabel * mod(\i, 2)}) {$\pickedDirection$};
				\fi%
			}%
		\end{scope}
	}%

	\begin{tikzpicture}
		% table parameters
		\pgfmathsetmacro{\scalevalue}{1.0}%
		\pgfmathsetmacro{\partialopacity}{0.4}%
		\pgfmathsetmacro{\scaleneighborhoods}{0.8}%
		\pgfmathsetmacro{\adjustdirectionlabel}{0.1}%
		\pgfmathsetmacro{\headeronescale}{0.50}%
		\pgfmathsetmacro{\headertwoscale}{0.37}%
		\pgfmathtruncatemacro{\numstates}{8}%
		\pgfmathtruncatemacro{\memwidth}{3}%

		\begin{scope}[scale=\scalevalue]
			\begin{scope}[opacity = \partialopacity, transparency group]
				\draw (-1, 0) grid ++(\numstates + 1, -9);
				\draw (0, 0) grid ++(\numstates, 1);
				\draw (0, 0)   -- ++(-1, 1);
			\end{scope}

			\begin{scope}[shift={(0.5, 0.5)}]
				\foreach \valid/\where[count=\i] in {1/0, 1/1, 1/2, 1/3, 1/4, 1/5, 1/6, 1/7} {%
					\ifnum\valid=1
						\pgfmathtruncatemacro{\memory}{\i-1}
						\node at (\where, 0) { $\padzeroes[\memwidth]{\binarynum{\memory}}$};
					\fi%
				}%

				\foreach \reads/\base[count=\state] in {1/0, 1/1, 1/2, 1/3, 1/4, 1/5, 1/6, 1/7, 1/8}{%
					\foreach \read in {1, ..., \reads}{%
						\node at (-1, -\base-\read) {\scalebox{\scaleneighborhoods}{\subimport{./}{State_\state.Readings_\read}}};
					}%
				}%

				\begin{scope}[shift={(-1, 0)}, rotate=-45, transform shape, font={\large}]
					\node[scale=\headeronescale, above] at (0, 0) {state};
					\node[scale=\headertwoscale, below] at (0, 0) {neighborhood};
				\end{scope}

				\SetNodeValue{0}{-1}{0}{1}
				\SetNodeValue{1}{-1}{2}{4}
				\SetNodeValue{3}{-1}{2}{1}
				\SetNodeValue{4}{-1}{5}{1}
				\SetNodeValue{6}{-1}{7}{4}
				\SetNodeValue{0}{-2}{0}{1}
				\SetNodeValue{1}{-2}{0}{2}
				\SetNodeValue{2}{-2}{3}{2}
				\SetNodeValue{4}{-2}{5}{1}
				\SetNodeValue{6}{-2}{6}{2}
				\SetNodeValue{7}{-2}{0}{1}
				\SetNodeValue{0}{-3}{1}{3}
				\SetNodeValue{2}{-3}{3}{2}
				\SetNodeValue{4}{-3}{4}{3}
				\SetNodeValue{5}{-3}{6}{2}
				\SetNodeValue{7}{-3}{6}{3}
				\SetNodeValue{0}{-4}{1}{3}
				\SetNodeValue{2}{-4}{2}{4}
				\SetNodeValue{3}{-4}{4}{3}
				\SetNodeValue{5}{-4}{4}{4}
				\SetNodeValue{6}{-4}{7}{4}
				\SetNodeValue{0}{-5}{0}{1}
				\SetNodeValue{1}{-5}{0}{2}
				\SetNodeValue{2}{-5}{2}{4}
				\SetNodeValue{3}{-5}{3}{2}
				\SetNodeValue{4}{-5}{5}{1}
				\SetNodeValue{6}{-5}{6}{2}
				\SetNodeValue{7}{-5}{7}{4}
				\SetNodeValue{0}{-6}{0}{1}
				\SetNodeValue{1}{-6}{1}{3}
				\SetNodeValue{2}{-6}{3}{2}
				\SetNodeValue{4}{-6}{4}{3}
				\SetNodeValue{5}{-6}{5}{1}
				\SetNodeValue{6}{-6}{6}{2}
				\SetNodeValue{7}{-6}{6}{3}
				\SetNodeValue{0}{-7}{1}{3}
				\SetNodeValue{2}{-7}{2}{4}
				\SetNodeValue{3}{-7}{3}{2}
				\SetNodeValue{4}{-7}{4}{3}
				\SetNodeValue{5}{-7}{4}{4}
				\SetNodeValue{6}{-7}{6}{2}
				\SetNodeValue{7}{-7}{7}{4}
				\SetNodeValue{0}{-8}{0}{1}
				\SetNodeValue{1}{-8}{1}{3}
				\SetNodeValue{2}{-8}{2}{4}
				\SetNodeValue{3}{-8}{2}{1}
				\SetNodeValue{4}{-8}{4}{3}
				\SetNodeValue{5}{-8}{5}{1}
				\SetNodeValue{6}{-8}{7}{4}
				\SetNodeValue{0}{-9}{0}{1}
				\SetNodeValue{1}{-9}{1}{3}
				\SetNodeValue{2}{-9}{2}{4}
				\SetNodeValue{3}{-9}{3}{2}
				\SetNodeValue{4}{-9}{4}{3}
				\SetNodeValue{5}{-9}{5}{1}
				\SetNodeValue{6}{-9}{6}{2}
				\SetNodeValue{7}{-9}{7}{4}
			\end{scope}
		\end{scope}
	\end{tikzpicture}
\end{document}
